package mst.trapdoorexploitfixer;

import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.block.BlockPlaceEvent;
import org.bukkit.inventory.ItemStack;
import org.bukkit.plugin.java.JavaPlugin;

public final class TrapdoorExploitFixer extends JavaPlugin {

    @Override
    public void onEnable() {
        getServer().getPluginManager().registerEvents(new BukkitListener(), this);
    }

    private static class BukkitListener implements Listener {
        @EventHandler
        private void interactTrapdoor(BlockPlaceEvent event) {
            final ItemStack stack = event.getItemInHand();
            if (stack.getType() != Material.REDSTONE)
                return;

            final Block block = event.getBlock().getLocation().add(0, -1, 0).getBlock();
            if (isTrapdoor(block)) {
                event.setCancelled(true);
            }
        }

        private static boolean isTrapdoor(Block block) {
            return switch (block.getType()) {
                case OAK_TRAPDOOR,
                        DARK_OAK_TRAPDOOR,
                        IRON_TRAPDOOR,
                        BIRCH_TRAPDOOR,
                        JUNGLE_TRAPDOOR,
                        SPRUCE_TRAPDOOR,
                        WARPED_TRAPDOOR,
                        CRIMSON_TRAPDOOR,
                        ACACIA_TRAPDOOR ->
                        true;
                default -> false;
            };
        }
    }
}
